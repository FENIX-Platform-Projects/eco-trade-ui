<!DOCTYPE html>
<html>
<head>

    <title>ECO TRADE</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <!-- Third Party CSS -->
    <link href="//fenixrepo.fao.org/cdn/js/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">

    <!-- FENIX-UI-MAP CSS -->
    <link rel="stylesheet" href="//fenixrepo.fao.org/cdn/js/leaflet/0.7.3/leaflet.css" />
    <link rel="stylesheet" href="//fenixrepo.fao.org/cdn/js/jquery.power.tip/1.2.0/css/jquery.powertip.css" type="text/css" />
    <link rel="stylesheet" href="//fenixrepo.fao.org/cdn/js/jquery-ui/1.10.3/jquery-ui-1.10.3.custom.min.css" />
    <link rel="stylesheet" href="//fenixrepo.fao.org/cdn/js/fenix-ui-map/0.1/fenix-ui-map.min.css" />

    <!-- FENIX style CSS -->
    <link href="http://fenixrepo.fao.org/cdn/fenix/fenix-ui-common/0.0.1/css/fenix-style.css" rel="stylesheet">

    <!-- ECO TRADE CSS -->
    <link href="../css/main.css" rel="stylesheet">

</head>

<body>
<div class="container">

    <div class="row afo-tabs">

        <div class="col-xs-12">
            <ul id="catalogue_tabs" class="nav nav-tabs" role="tablist">
                <li class="active"><a href="#page_region" role="tab" data-toggle="tab">ECO Region</a></li>
                <li><a href="#page_countries" role="tab" data-toggle="tab">ECO Countries</a></li>
            </ul>
        </div>

    </div>

    <div class="row">
        <div class="col-xs-12">
            <div class="tab-content">
                <div class="tab-pane active row" id="page_region">
                    REGION

                    <div class="row">
                        <div class="col-sm-6">
                            <div id="chart_commodity">
                                <!-- FILLED BY JS -->
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div id="chart_within_eco">
                                <!-- FILLED BY JS -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane row" id="page_countries">
                    COUNTRIES

                    <div class="row">
                        <div class="col-sm-6">
                            <p>TRADE BALANCE</p>
                            <div id="chart_balance">
                                <!-- FILLED BY JS -->
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <p>BAR CHART</p>
                            <div id="chart_bars">
                                <!-- FILLED BY JS -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>            
    <!-- SIDEBAR -->
</div>
</body>

<script src="//fenixrepo.fao.org/cdn/js/requirejs/2.1.15/require.min.js"></script>
<script>
/*global requirejs*/
requirejs(['../js/paths'], function (paths) {

    paths.baseUrl = '../';

    requirejs.config(paths);

    requirejs([
        'jquery','underscore','bootstrap','handlebars',
        'WDSClient',
        'fx-c-c/start',
        'Config'
    ], function ($, _, bootstrap, Handlebars,
        WDSClient,
        FXChart,
        Config
    ) {

        var creator = new FXChart();
        var wdsClient = new WDSClient(Config.wds_config);



        init();
        function init() {
            // country
            createChart(Config.queries.country_balance, true, true)
            createChart(Config.queries.country_bar,true,false)

            // region
            createChart(Config.queries.region_within,false, true)
            createChart(Config.queries.region_year,false, false)

        }



        function createChart(query, isCountry,isSpecial) {
            var callback;
            if (isCountry) {
                callback = (isSpecial) ? renderCountryBalance : renderCountryNormal;
            } else {
                callback = (isSpecial) ? renderRegionWithin : renderRegionBar;
            }
            console.log(callback)


            wdsClient.retrieve({
                payload: {query: query,
                   queryVars: {
                        year_list: [2001,2002].join(),
                        trade_flow_code:"EXP",
                        commodity_code:"AGR",
                    }
                },
                success: function (model) {
                    creator.init({
                        model: model,
                        template: {},
                        creator: {},
                        onReady: callback
                    });
                }
            });
        }


        function renderCountryBalance(creator) {
            console.log(creator)

            creator.render({
                container: "#chart_balance",
                creator: {
                    chartObj: {
                        chart: {
                            type: "column"
                        }
                    }
                }
            });
        }


        function renderCountryNormal(creator) {
            console.log(creator)
            creator.render({
                container: "#chart_bars",
                creator: {
                    chartObj: {
                        chart: {
                            type: "column"
                        }
                    }
                }
            });
        }

        function renderRegionWithin(creator) {
            console.log(creator)

            creator.render({
                container: "#chart_within_eco",
                adapter: {
                    // used in init just for MATRIX and FENIX
                    xOrder: 'asc',
                    xDimensions: [0],
                    valueDimensions: 2,
                    seriesDimensions: [1]
                }
            });
        }

        function renderRegionBar(creator) {
            console.log(creator)

            creator.render({
                container: "#chart_commodity",
                adapter: {
                    // used in init just for MATRIX and FENIX
                    xOrder: 'asc',
                    xDimensions: [0],
                    valueDimensions: 2,
                    seriesDimensions: [1]
                },
                creator: {
                    chartObj: {
                        chart: {
                            type: "column"
                        }
                    }
                }
            });
        }


        console.log(FXChart)

    });
});    
</script>
</html>